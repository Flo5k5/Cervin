<?php
$title = 'Gestion des utilisateurs';
$this->headTitle($title);
?>

<?php $this->headLink()->prependStylesheet($this->basePath() . '/css/bootstrap-editable.css'); ?>
<?php $this->headLink()->prependStylesheet($this->basePath() . '/css/datatable.css'); ?>
     
<!-- Help Modal -->
<div id="helpModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
	    <h3 id="myModalLabel">Aide : gestion des utilisateurs</h3>
    </div>
    <div class="modal-body">
    	<p>Cette page vous permet en tant qu'administrateur de l'application de gérer l'ensemble des utilisateurs. 
    	Vous pouvez effectuer une recherche parmis tous les utilisateurs, puis modifier leur login, nom, email et rôle en cliquant directement dessus.
    	</p>
    	<p>Les rôles possibles pour un utilisateurs sont :
    	<dl class="dl-horizontal">
    		<dt>Rôle Visiteur</dt>
		    <dd>L'utilisateur est bloqué</dd>
		    <dt>Rôle Utilisateur</dt>
		    <dd>Permet de consulter la collection et les parcours</dd>
		    <dt>Rôle Collection</dt>
		    <dd>Permet (en plus) d'alimenter la collection</dd>
		    <dt>Rôle Parcours</dt>
		    <dd>Permet (en plus) d'éditer des parcours</dd>
		    <dt>Rôle Admin</dt>
		    <dd>Tous les droits</dd>
		</dl>
    	</p>
    </div>
    <div class="modal-footer">
	    <button class="btn" data-dismiss="modal" aria-hidden="true">Retour</button>
    </div>
</div>

<div class="page-header">
    <h1><?php echo $this->escapeHtml($title); ?> 
    <small> <a href="#helpModal" data-toggle="modal"><i class="icon-info-sign"> </i></a></small> </h1>
</div>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="span12">
            <div>
                <table class="table table-striped table-bordered" id="data">
                    <thead>
                        <tr>
                            <th>Login</th>
                            <th>Nom / Prenom</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="5">En cours de téléchargement</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<?php $this->headScript()->appendFile($this->basePath() . '/js/bootstrap-editable.js') ;?>
<?php $this->headScript()->appendFile($this->basePath() . '/js/dataTables.js') ;?>
<?php $this->headScript()->appendFile($this->basePath() . '/js/bootstrap-confirm.js') ;?>

<div id="confirmDiv" >
</div> 

<?php $this->headScript()->captureStart() ?>
	var table;
	$(function() {
	    var URL = '<?php echo $this->url("admin/gestion-users"); ?>';
	    table = ResultSet.paginate(
			{
				"fnDrawCallback": function () {
					$('.status').editable({
						source: [
	                    <?php foreach ($roles as $role) : ?>
									{value: <?php echo $role->getId();?>, text: '<?php echo $role->getRoleId();?>'},
	                    <?php endforeach; ?>
								]
					});
	
	                $('.text').editable({ });
	
	                $(".SupprimerUser").click(function(event){
	                    var dateURL = $(this).attr('data-url');
	                    var dateValue = $(this).attr('data-value');
	                    $('#confirmDiv').confirmModal({
	                        heading:'Confirmation',
	                        body:"Êtes-vous sûr de vouloir supprimer définitivement l'utilisateur : "+dateValue+" ?",
	                        callback: function() {
	                            $.post( 
	                                dateURL,
	                                { name: "supprimer" },
	                                function() {
	                                    $("#data").dataTable().fnDraw();
	                                });
	                        }
	                    });   
	                });
				},
	            "aoColumns": [
	                              null,
	                              null,
	                              null,
	                              null,
	                              { "bSortable": false  },
	                         ],
	            "iColumns": 5,
	            "bProcessing": true,
	         	"bServerSide": true,
	         	"sAjaxSource": URL
			}
		);
	});
<?php $this->headScript()->captureEnd() ?>
