<?php 
$title = $artefact->titre;
$this->headTitle($title);
?>

<?php  $this->headLink()->prependStylesheet($this->basePath() . '/css/bootstrap-editable.css'); ?>

<div class="page-header row-fluid">
	<div class="span9">
	<h1><i class="icon-tag"></i> <?php echo $this->escapeHtml($title); ?> <!-- <small>Subtext for header</small> --></h1>
	</div>
	<?php if ($this->isAllowed('Collection') === true) :?>
		<a href="<?php echo $this->url('artefact/editArtefact',array('id' => $artefact->id)) ?>" 
			class="btn btn-primary span3">
			<i class="icon-pencil"> </i> Modifier cet artefact
		</a>
		<a href="#confirmModal" 
			data-toggle="modal" 
			class="btn btn-danger span3">
			<i class="icon-trash"> </i>  Supprimer cet artefact
		</a>
    <?php endif; ?>
</div>

<!--Confirm Modal -->
<div id="confirmModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
	    <h3 id="myModalLabel">Confirmation : suppression d'un artefact</h3>
    </div>
    <div class="modal-body">
    	Êtes-vous sur de vouloir supprimer l'artefact "<?php echo $artefact->titre; ?>" ?
    </div>
    <div class="modal-footer">
	    <a href="<?php echo $this->url('artefact/removeArtefact',
            array('id' => $artefact->id)) ?>" class="btn btn-primary">Supprimer</a>
        <button class="btn" data-dismiss="modal" aria-hidden="true">Retour</button>
    </div>
</div>

<div class="row-fluid">
	<div class="span6">
		<p><?php echo $artefact->description;?></p>
	</div>
	<div class="span6 well">
		<ul class="nav nav-tabs">
			<li class="active"><a href="#tab1" data-toggle="tab"><i class="icon-info-sign"></i> Informations</a></li>
			<li><a href="#tab2" data-toggle="tab"><i class="icon-sitemap"></i> Artefacts liés</a></li>
			<li><a href="#tab3" data-toggle="tab"><i class="icon-sitemap"></i> Medias</a></li>
		</ul>
		<div class="tab-content" style="padding-bottom: 9px; border-bottom: 1px solid #ddd;">
			<div class="tab-pane active" id="tab1">
				<dl>
					<dt>Type d'artefact</dt>
					<dd>
						<?php 
							echo $artefact->type_element->nom; 
							echo '</br></br>';
						?>
					</dd>
					
					<?php foreach( ($artefact->datas) as $data) : ?>
						<?php if ($data->{$data->champ->format} != null): ?>
							<dt>
								<?php echo $data->champ->label ?> 
								<?php if ($data->champ->description != null) : ?>
					        	<a href="#" 
				        			class="description"
				        			rel="popover"
				        			data-content="<?php echo $data->champ->description; ?>"
				        			data-original-title="Description du champ"><i class="icon-question-sign"></i></a>  
				        		<?php endif; ?>
							</dt>
							<dd>
								<?php switch ($data->champ->format) :
	        						case 'texte':
	        							echo $data->{$data->champ->format};
										echo '</br></br>';
									break;
									case 'textarea':
										echo $data->{$data->champ->format};
										echo '</br></br>';
									break;
									case 'date':
										echo $data->date->format('d-m-Y');
										echo '</br></br>';
									break;
									case 'nombre':
										echo $data->{$data->champ->format};
										echo '</br></br>';
									break;
									case 'fichier':
										echo '<a href="' . ROOT_DIR . $data->{$data->champ->format}.'">'.basename($data->{$data->champ->format}).'</a>';
										echo '</br></br>';
									break;
									case 'url':
										echo '<a href="' . $data->{$data->champ->format}.'">'.$data->{$data->champ->format}.'</a>';
										echo '</br></br>';
									break;
									?>
								<?php endswitch ;?>
							</dd>
						<?php endif; ?>
					<?php endforeach ; ?>
				</dl>
			</div>
			<div class="tab-pane" id="tab2">
				<p> <i class="icon-warning-sign"> </i>  Section en construction... </p>
				<?php /*$relations_artefacts = array();
				
				foreach( ($artefact->relations_artefacts) as $relation_artefact) :
					$relations_artefacts[$relation_artefact->semantique->type_destination->id]['nom'] = $relation_artefact->semantique->type_destination->nom;
					$relations_artefacts[$relation_artefact->semantique->type_destination->id]['id'] = $relation_artefact->semantique->type_destination->id;
					$relations_artefacts[$relation_artefact->semantique->type_destination->id]['value'][] = $relation_artefact->origine->titre.
					' '.$relation_artefact->semantique->semantique.
					' <a href="'.$this->url("artefact/voirArtefact",array('id'=>$relation_artefact->destination->id)).'" >'.$relation_artefact->destination->titre.
					'</a><br>' ;

					endforeach ;
					echo '<div class="tabbable tabs-left"><ul class="nav nav-tabs">';
					$i = 0;
					foreach($relations_artefacts as $key =>$relation_artefact) :
						if ($i == 0){$active = ' class="active"';} else { $active='';}
						echo '<li'.$active.'><a href="#RelA'.$relation_artefact['id'].'" data-toggle="tab">'.$relation_artefact['nom'].'</a></li>';
					$i++;
					endforeach ;
					echo '</ul><div class="tab-content">';
					$i = 0;
					foreach($relations_artefacts as $key =>$relation_artefact) :
						if ($i == 0){$active = ' active';} else { $active='';}
						echo '<div class="tab-pane'.$active.'" id="RelA'.$relation_artefact['id'].'">';

							foreach ($relation_artefact['value'] as $value) {
								echo '<p>'.$value.'</p>';
							}
						echo '</div>';
					$i++;
					endforeach ;
					echo '</div></div>';*/
					?>
				
				</div>
				<div class="tab-pane" id="tab3">
					<p> <i class="icon-warning-sign"> </i>  Section en construction... </p>
						<?php //foreach( ($artefact->medias) as $media) :?>
							<?php //echo $media->type_element->nom ?>
						<?php //endforeach ;?>
				</div>
			</div>
		</div>
	</div>
</div>

<?php $this->inlineScript()->captureStart() ?>

	$(function () {
							
		$(".description").popover({placement:'top', trigger:'hover'}); 
		
		$('body').on('click', 'input.span2', function(event) {
			$(this).datepicker({
				showOn: 'focus',
				yearRange: '1900:+0',
				changeMonth: true,
				changeYear: true
			}).focus();
		});

    });
    
<?php $this->inlineScript()->captureEnd() ?>

<?php $this->headScript()->appendFile($this->basePath() . '/js/bootstrap-datepicker.js'); ?>