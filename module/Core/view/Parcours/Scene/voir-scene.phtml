<?php 
$title = $scene->titre;
$this->headTitle($title); ?>

<style type="text/css">
	.sous_parcours {
		border-style: dashed;
		border-width: 3px;
		border-color: #006699;
	}
	
</style>

<?php $estRecommandee = ($scene instanceof \Parcours\Entity\SceneRecommandee);?>

	<!-- Titre -->
	<div class="page-header">
		<div class="row-fluid">
			<div class="span8">
			<?php if ($estRecommandee) :?>
				<h1><p class="text-info">
			<?php else : ?>
					<h1><p class="muted">
			<?php endif;?>
			<i class="icon-file-alt"></i>
			<?php echo $this->escapeHtml($title); ?> </p></h1>
			</div>
			<div class="span4">
			<a href="<?php echo $this->url('parcours/voir', array('id' => $scene->sous_parcours->parcours->id)) ?>" 
				class="btn btn-primary btn-block"> 
				<i class="icon-reply"></i> Retour au parcours <em><?php echo $scene->sous_parcours->parcours->titre; ?></em>
			</a>
			<a href="<?php echo $this->url('scene/editScene',array('id' => $scene->id)) ?>" 
				class="btn btn-primary btn-block">
				<i class="icon-pencil"> </i> Modifier cette scène
		    </a>
		    </div>
	    </div>
	</div>
	
	
	<div class="tabbable"> <!-- Only required for left/right tabs -->
		<ul class="nav nav-tabs">
			<li class="active"><a href="#tab1" data-toggle="tab">Contenu de la scène</a></li>
			<li><a href="#tab2" data-toggle="tab">Scènes voisines</a></li>
		</ul>

		<div class="tab-content">
		
			<!-- Fiche de la scène -->
			<div class="tab-pane active" id="tab1">
		
				<div class="row-fluid">
				
					<!-- Narration de la scène -->
					<div class="span8">
						<p><?php echo $scene->narration;?></p> <!-- créé avec le wysihtml5 donc pas de escapehtml -->
					</div>
					
					<!-- Eléments de la collection liés à la scène -->
					<div class="span4">
						<div class="well">
							<h4> A voir dans cette scène </h4>
							<?php if ($scene->elements->count() == 0): ?>
								Aucun élément de la collection n'est lié à cette scène.
							<?php endif; ?>
							<ul class="nav nav-list">
							<?php foreach( ($scene->elements) as $element) : ?>
								<?php if($element instanceof Collection\Entity\Artefact): ?>
									<li>
										<a href="<?php echo $this->url('artefact/voirArtefact',array('id' => $element->id)); ?>">
										<i class="icon-tag"></i>  <?php echo $this->escapeHtml($element->titre); ?> 
										</a>
									</li>
								<?php else : ?>
									<li class="">
										<a href="<?php echo $this->url('media/voirMedia',array('id' => $element->id)); ?>">
										<i class="icon-picture"></i>  <?php echo $this->escapeHtml($element->titre); ?> 
										</a>
									</li>
								<?php endif;  ?>
							<?php endforeach; ?>
							</ul>
						</div>
						
					</div>
					
				</div>
				
			</div> <!-- /tab1 -->
			
			<!-- Transitions autour de cette scène -->
			<div class="tab-pane" id="tab2">
			
				<!-- Transitions recommandées autour de cette scène -->
				<?php if ($estRecommandee) :?>
				<div class="row-fluid">
				
					<!-- Transitions entrantes -->
					<div class="span6">
						<h4><p class="text-info">Transition recommandée entrante</p></h4>
							<table class="table">
							<?php if ($scene->transition_recommandee_entrante == null) :?>
								<p class="text-info">Première scène recommandée du parcours</p>
							<?php else: ?>
								<tr>
									<td>
										<a href="<?php echo $this->url('scene/voirScene', array('id' => $scene->transition_recommandee_entrante->scene_origine->id)) ?>"> 
											<p class="text-info">
											<i class="icon-file-alt"></i>  
											<em> <?php echo $this->escapeHtml($scene->transition_recommandee_entrante->scene_origine->titre); ?> </em>
											<i class="icon-arrow-right"></i>  
											</p>
										</a>
									</td>
									<td>
										<p class="text-info">
										[<?php echo ($scene->transition_recommandee_entrante->semantique) ? $scene->transition_recommandee_entrante->semantique->semantique : 'Sémantique inconnue' ; ?>]
							           	<?php echo $this->escapeHtml($scene->transition_recommandee_entrante->narration); ?>
								        </p>
									</td>
								</tr>
							<?php endif;?>
						</table>
					</div> <!-- /span6 transition recommandée entrante -->
					
					<!-- Tranitions sortantes -->
					<div class="span6">
						<h4><p class="text-info">Transition recommandée sortante</p></h4>
						<table class="table">
							<?php if ($scene->transition_recommandee == null ) :?>
								<p class="text-info">Dernière scène recommandée du parcours</p>
							<?php else: ?>
								<?php $transition = $scene->transition_recommandee; ?>
								<tr>
									<td>
										<p class="text-info">
										[<?php echo ($transition->semantique) ? $transition->semantique->semantique : 'Sémantique inconnue' ; ?>]
							            <?php echo $this->escapeHtml($transition->narration); ?>
								        </p>
									</td>
							        <td>
										<a href="<?php echo $this->url('scene/voirScene', array('id' => $transition->scene_destination->id)) ?>"> 
											<p class="text-info">
											<i class="icon-arrow-right"></i>  
											<i class="icon-file-alt"></i>  
											<em> <?php echo $this->escapeHtml($transition->scene_destination->titre); ?> </em>
											</p>
										</a>
									</td>
								</tr>
							<?php endif;?>
				       	</table>
					</div> <!-- /span6 transition recommandée sortante -->
				</div> <!-- /row-fluid transitions recommandée -->
				<hr>
				<?php endif;?>
			
				<!-- Transitions secondaires autour de cette scène -->
				<div class="row-fluid">
				
					<!-- Transitions secondaires entrantes -->
					<div class="span6">
						<h4><p class="muted">Transitions secondaires entrantes</p></h4>
						<table class="table">
							<?php if ($scene->transitions_secondaires_entrantes == null
									|| $scene->transitions_secondaires_entrantes->count() == 0):?>
								<p class="muted">Aucune tansition secondaire ne mène à cette scène.</p>
							<?php else: ?>
								<?php foreach ($scene->transitions_secondaires_entrantes as $transition) : ?>
									<tr>
										<td>
											<a href="<?php echo $this->url('scene/voirScene', array('id' => $transition->scene_origine->id)) ?>"> 
												<?php if ($transition->scene_origine instanceof \Parcours\Entity\SceneRecommandee) :?>
														<p class="text-info">
												<?php else : ?>
														<p class="muted">
												<?php endif;?>
												<i class="icon-file-alt"></i>  
												<em> <?php echo $this->escapeHtml($transition->scene_origine->titre); ?> </em>
												<i class="icon-arrow-right"></i> 
												</p>
											</a>
										</td>
										<td>
											<p class="muted">
											[<?php echo ($transition->semantique) ? $transition->semantique->semantique : 'Sémantique inconnue' ; ?>]
											"<?php echo $this->escapeHtml($transition->narration); ?>"
											</p>
										</ul>
										</td>
									</tr>
								<?php endforeach; ?>
							<?php endif;?>
						</table>
					</div>
					
					<div class="span6">
						<h4><p class="muted">Transitions secondaires sortantes</p></h4>
						<table class="table">
							<?php if ($scene->transitions_secondaires == null 
									|| $scene->transitions_secondaires->count() == 0) :?>
								<p class="muted">Aucune tansition secondaire ne part de cette scène.</p>
							<?php else: ?>
								<?php foreach ($scene->transitions_secondaires as $transition) : ?>
									<tr>
										<td>
											<p class="muted">
											[<?php echo ($transition->semantique) ? $transition->semantique->semantique : 'Sémantique inconnue' ; ?>]
											"<?php echo $this->escapeHtml($transition->narration); ?>"
											</p>
										</td>
										<td>
											<a href="<?php echo $this->url('scene/voirScene', array('id' => $transition->scene_destination->id)) ?>"> 
												<?php if ($transition->scene_destination instanceof \Parcours\Entity\SceneRecommandee) :?>
														<p class="text-info">
												<?php else : ?>
														<p class="muted">
												<?php endif;?>
												<i class="icon-arrow-right"></i> 
												<i class="icon-file-alt"></i> 
												<em> <?php echo $this->escapeHtml($transition->scene_destination->titre); ?> </em>
												</p>
											</a>
										</ul>
										</td>
									</tr>
								<?php endforeach; ?>
							<?php endif;?>
				       	</table>
					</div>
					
				</div>
				
			</div> <!-- /tab 2 -->
		</div> <!-- / tab-conttent -->
	</div> <!-- / tabbable -->
</div> <!-- / row-fluid -->
